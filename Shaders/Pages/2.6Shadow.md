# 阴影
## Unity中的平行光阴影

### 平行光的阴影

ShadowMap的实现主要分为两个pass:

<br>**第一个pass：** 在光源位置创建一个深度摄像机，以光源位置作为视点，将每个像素点的深度值（z-depth）也就是距离光源最近的对象距离记录在 Z-buffer 中，生成深度图

<br>**第二个pass：** 从正常摄像机渲染场景，将每个fragment 到光源的距离和 Shadow Map 中保存的深度值进行比较，如果大于后者则说明被其他物体遮挡处于阴影之中

<br>![image](https://user-images.githubusercontent.com/74708198/233792279-48a2f86d-d01b-4694-a252-573842a246e4.png)

## Shadow Map的问题以及优化方案

Shadow Acne: 阴影的产生和深度纹理的像素是相关的。深度纹理像素值越高，shadow acne的效果相对来说越小，然而shadow acne不可能通过提高像素来完全消除。因为只要光线和法向量的夹角不是90度，永远会有一部分的geometry会被判定处在阴影当中。这个问题可以通过给深度值加一个小小的bias来解决。通过法向量的和光线的夹角来判断bias要更为准确:
<br>float bias = max(max_bias * (1.0 - dot(normal, lightDir)), min_bias); 
<br>![image](https://user-images.githubusercontent.com/74708198/233792348-6137cd07-6fa7-4a1f-9803-998792032610.png) ![image](https://user-images.githubusercontent.com/74708198/233792353-0b843957-4493-443d-b592-53abf09ae89b.png)

阴影边缘抗锯齿: PCF(Percentage Closer Filtering)通过对附近像素多次采样求平均来实现阴影边缘抗锯齿，达到软阴影的效果
<br>![image](https://user-images.githubusercontent.com/74708198/233792383-dca1dc21-1ec4-4e3e-9921-5a2ec0a25e93.png) ![image](https://user-images.githubusercontent.com/74708198/233792385-7dca4441-243d-4af1-8f84-3487bde48dc3.png)




